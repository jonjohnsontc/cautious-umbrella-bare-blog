<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Too small to be updates in their own right, but I gotta tell somebody! Here's what I learned this past week, ending on 8/21/21.">
    <title> This Week I Learned - I ~ Jon Johnson </title>
    <meta name="theme-color" content="#b16286">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/codehilite-styles.css">
    <link rel="stylesheet" href="/code-styles-booberry.css">
    <link rel="stylesheet" href="/code-styles-dark-2.css">
</head>
<body>
    <nav class="nav" role="navigation" aria-label="main-navigation">
    <ul>
        <li id="waving-hand">
            <a class="nav-link" href="/">
                üëãüèΩ
            </a>
        </li>
        <li>
            <a class="nav-link" href="/about">
                about
            </a>
        </li>
        <li>
            <a aria-current="page" class="nav-link nav-link--active" href="/blog">blog</a>
        </li>

        <li>
            <div class="palette-dropdown">
                <button id="dropdown-button" class="nav-button">
                    <svg id="palette" viewBox="0 0 201 199" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M201 99.5C201 138.678 177.558 131.651 156.19 125.246C143.464 121.427 131.467 117.82 125.625 124.375C118.05 132.87 119.658 146.999 121.216 160.693C123.439 180.282 125.575 199 100.5 199C80.623 199 61.1924 193.164 44.6652 182.231C28.1381 171.298 15.2568 155.758 7.65015 137.577C0.0435447 119.396 -1.94669 99.3897 1.93112 80.0885C5.80894 60.7874 15.3806 43.0582 29.4358 29.1429C43.491 15.2276 61.3984 5.75114 80.8935 1.91191C100.389 -1.92732 120.596 0.0431115 138.96 7.57403C157.324 15.1049 173.02 27.8581 184.063 44.2208C195.106 60.5835 201 79.8208 201 99.5V99.5ZM100.5 186.563C108.176 186.563 108.716 184.436 108.728 184.374C109.708 182.558 110.286 178.603 109.608 170.456C109.432 168.366 109.143 165.854 108.842 163.105C108.188 157.334 107.435 150.606 107.359 144.922C107.234 136.128 108.402 124.897 116.203 116.141C120.839 110.955 126.818 108.953 132.183 108.455C137.258 107.982 142.383 108.778 146.755 109.749C151.064 110.706 155.574 112.062 159.632 113.281L159.983 113.38C164.33 114.686 168.25 115.855 171.956 116.689C180.159 118.529 183.312 117.721 184.405 116.987C184.882 116.664 188.438 113.94 188.438 99.5C188.438 82.2807 183.28 65.4481 173.617 51.1307C163.955 36.8133 150.221 25.6543 134.152 19.0648C118.084 12.4752 100.402 10.7511 83.3443 14.1104C66.2861 17.4697 50.6171 25.7616 38.3188 37.9376C26.0206 50.1135 17.6453 65.6265 14.2522 82.515C10.8591 99.4034 12.6006 116.909 19.2564 132.817C25.9122 148.726 37.1833 162.323 51.6446 171.89C66.1058 181.456 83.1076 186.563 100.5 186.563V186.563Z"
                            style="fill: var(--primary)" />
                        <ellipse lass="ellipse-cyan" cx="50" cy="86.1342" rx="19" ry="18.8109"
                            style="fill: var(--cyan)" />
                        <ellipse class="ellipse-purple" cx="100" cy="43.5624" rx="19" ry="18.8109"
                            style="fill: var(--purple)" />
                        <ellipse class="ellipse-red" cx="151" cy="81.184" rx="19" ry="18.8109"
                            style="fill: var(--red)" />
                        <ellipse class="ellipse-yellow" cx="75" cy="142.567" rx="19" ry="18.8109"
                            style="fill: var(--yellow)" />
                    </svg>

                </button>
                <div id="dropdown-content" class="dropdown-content swing-in-top-fwd">
                    <button id="default" class="theme-button theme-button--active">
                        <div class="theme-selector">
                            <h4>default</h4>
                        </div>
                    </button>
                    <button id="gruvbox" class="theme-button">
                        <div class="theme-selector">
                            <h4>Gruvbox</h4>
                        </div>
                    </button>
                    <button id="booberry" class="theme-button">
                        <div class="theme-selector">
                            <h4>Booberry</h4>
                        </div>
                    </button>
                    <button id="dark" class="theme-button">
                        <div class="theme-selector">
                            <h4>Dark</h4>
                        </div>
                    </button>
                </div>
            </div>
        </li>
    </ul>
</nav>
    <section class="blog-post-container">
        <article class="blog-post-content container">
            <h1 class="blog-title">This Week I Learned - I</h1>
            <h5 class="blog-subtitle">Published on: 2021-08-21</h5>
            <p>Too small to be updates in their own right, but I gotta tell somebody! Here's what I learned this past week, ending on 8/21/21.</p>
<h2>Profiling Python Applications on a Server</h2>
<p>In trying to diagnose bottlenecks in a slow running application at work, I learned about different profiling options within Python. For Flask applications, Werkzeug <a href="https://werkzeug.palletsprojects.com/en/2.0.x/middleware/profiler/">provides</a> a <code>ProfilerMiddleware</code>that makes it simple to see which processes are taking the most time. However, because it uses <a href="https://docs.python.org/3/library/profile.html#module-cProfile">cProfile</a> to do the profiling, it doesn't give you any introspection into multithreaded applications in the non-main thread.</p>
<p>Enabling it is pretty simple. All you need to do is wrap your Flask wsgi instance in the middleware, and any calls you make to the API are automatically returned with a printout of the timing of function calls customized to your liking via the standard library's <code>pstats.Stats</code> interpretation of <a href="https://docs.python.org/3/library/profile.html#pstats.Stats.print_stats">restrictions</a>.</p>
<p><strong>e.g.,</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">ProfilerMiddleware</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">,</span> <span class="n">restrictions</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">])</span>
</code></pre></div>

<p>Here's where <a href="https://pypi.org/project/yappi/">yappi</a> comes in. It's a library that allows you to profile any multithreaded applications at run simply by running <code>yappi.start()</code> and <code>yappi.stop()</code> to indicate when the profiler should in fact, be running. The best thing is, yappi provides a method to convert its statistical output in <code>pstats.Stats()</code> format, the same used by cProfile.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">current_app</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">flask_restx</span> <span class="kn">import</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">Resource</span>
<span class="kn">import</span> <span class="nn">yappi</span>

<span class="n">ns</span> <span class="o">=</span> <span class="n">Namepace</span><span class="p">(</span><span class="s2">&quot;sprocket-rocket&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;delivering sprockets to kewl users&quot;</span><span class="p">)</span>

<span class="o">...</span>
<span class="nd">@ns</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/profile&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">SprocketProfile</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="n">yappi</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">process_sprockets</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">yappi</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">response_class</span><span class="p">(</span>
            <span class="n">response</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;upload successful&quot;</span><span class="p">}),</span>
            <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<p>I chose to hack together an endpoint, and start/stop yappi around the process which I wanted to profile.</p>
<h2>Putting Together a Markdown based blog with Gatsby</h2>
<p>Due to creative frustrations, my curiosity pulling me in a thousand directions, and just a lack of vision, I've been putting off the creation of my own website for some time. However, finally deploying my Songwriter Graph <a href="https://www.songwritergraph.org">website</a> I think gave me the encouragement that I needed to get started.</p>
<p>I hadn't ever built anything in javascript outside of a couple of automated
frontend testing scripts (the songwriter graph is written in clojurescript, as is
the UI I contribute to at work), so I wanted my personal site to be a "gentle" introduction
to the language. After a heated "eeny meeny..." session between a few frontend frameworks
that specialize in Server Side Rendering (SSR), I decided to roll with making my
site in Gatsby (v3 in particular).</p>
<p>The idea of having a personal website / blog, which has pages are written in
Markdown has appealed to me since I'd heard of it a few years back. It's
surprising just how quickly I was able to get started crafting my own with the
combination of <a href="https://pages.github.com/">GitHub Pages</a> and a couple of Gatsby
"plugins", <code>gatsby-transformer-remark</code> and <code>gatsby-source-filesystem</code>.</p>
<p>Within a few hours, I had built a few React components strewn across some Gatsby
pages. One component in particular, named <code>blogTemplate</code> gave me all I needed to
start rendering Markdown pages as blog posts:</p>
<div class="codehilite">
                <pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Template</span><span class="p">({</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">markdownRemark</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">frontmatter</span><span class="p">,</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">markdownRemark</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">{&quot;blog-post-container</span><span class="w"> </span><span class="s">container&quot;}</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">{&quot;blog-post</span><span class="w"> </span><span class="s">hero</span><span class="w"> </span><span class="s">is-medium</span><span class="w"> </span><span class="s">has-background-grey-darker&quot;}</span><span class="nt">&gt;</span>
<span class="w">        </span>{/*<span class="w"> </span>We<span class="w"> </span>render<span class="w"> </span>a<span class="w"> </span>blank<span class="w"> </span>hero-body,<span class="w"> </span>and<span class="w"> </span>hero-foot<span class="w"> </span>with<span class="w"> </span>text<span class="w"> </span>to
<span class="w">        </span>give<span class="w"> </span>the<span class="w"> </span>title<span class="w"> </span>at<span class="w"> </span>bottom<span class="w"> </span>look<span class="w"> </span>*/}
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">{&quot;hero-body&quot;}</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">{&quot;hero-foot&quot;}</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;p</span>
<span class="w">            </span><span class="na">className=</span><span class="s">{</span>
<span class="w">              </span><span class="s">&quot;title</span><span class="w"> </span><span class="s">is-size-1</span><span class="w"> </span><span class="s">is-inline</span><span class="w"> </span><span class="s">has-text-white</span><span class="w"> </span><span class="s">is-family-sans-serif&quot;</span>
<span class="w">            </span><span class="s">}</span>
<span class="w">          </span><span class="nt">&gt;</span>
<span class="w">            </span>{frontmatter.title}
<span class="w">          </span><span class="nt">&lt;/p&gt;</span>
<span class="w">          </span><span class="nt">&lt;p</span><span class="w"> </span><span class="na">className=</span><span class="s">{&quot;pl-6</span><span class="w"> </span><span class="s">subtitle</span><span class="w"> </span><span class="s">is-inline</span><span class="w"> </span><span class="s">has-text-white&quot;}</span><span class="nt">&gt;</span>
<span class="w">            </span>{frontmatter.date}
<span class="w">          </span><span class="nt">&lt;/p&gt;</span>
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">      </span><span class="nt">&lt;/div&gt;</span>

<span class="w">      </span><span class="nt">&lt;div</span>
<span class="w">        </span><span class="na">className=</span><span class="s">{&quot;blog-post-content</span><span class="w"> </span><span class="s">mt-6&quot;}</span>
<span class="w">        </span><span class="na">dangerouslySetInnerHTML=</span><span class="cp">{{</span> <span class="nv">__html</span><span class="o">:</span> <span class="nv">html</span> <span class="cp">}}</span>
<span class="w">      </span><span class="s">/</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;footer</span>
<span class="w">        </span><span class="na">className=</span><span class="s">&quot;footer&quot;</span>
<span class="w">        </span><span class="na">children=</span><span class="s">{</span>
<span class="w">          </span><span class="s">&lt;span</span><span class="w"> </span><span class="na">className=</span><span class="s">&quot;has-text-centered&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>~<span class="w"> </span>Thanks<span class="w"> </span>for<span class="w"> </span>reading!<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span>enjoyed<span class="w"> </span>it,<span class="w"> </span>consider<span class="w"> </span>sharing<span class="w"> </span>it<span class="w"> </span>with
<span class="w">            </span>someone<span class="w"> </span>u<span class="w"> </span>like<span class="w"> </span>üíú<span class="w"> </span>~
<span class="w">          </span><span class="nt">&lt;/span&gt;</span>
<span class="w">        </span>}
<span class="w">      </span>/&gt;
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="w">  </span>);
}
</code></pre>
            </div>

<p>Here, <code>Template</code> is a template for an individual post. Coupled with a page to
list all of the blog entries, I've got a solution for my website's blog that I
can continue to improve upon with time.</p>


<footer>
    ~~~<br>
    This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License
</a>.
<br>
    Please share if you like :0)
</footer>        </article>
    </section>
    <script src="/script.js"></script>
</body>

</html>